<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>
    
     Fisheries Collapse &middot; RCDS
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/rcds/public/css/poole.css">
  <link rel="stylesheet" href="/rcds/public/css/syntax.css">
  <link rel="stylesheet" href="/rcds/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/rcds/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/rcds/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  
  <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <!--
  <script type="text/x-mathjax-config"> 
  MathJax.Hub.Config({
    TeX: { equationNumbers: {autoNumber: "AMS"} }
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ]
      displayMath: [ ['$$','$$'], ['\[','\]'] ]
    }
  });       
  </script>

  -->
</head>


  <body class="theme-base-berkeley">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/rcds">
          RCDS
        </a>
      </h1>
      <p class="lead">Reproducible and Collaborative Data Science</p>
    </div>

    <nav class="sidebar-nav">
      <!--      <a class="sidebar-nav-item" href="/rcds">Home</a> -->

      

      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a class="sidebar-nav-item" href="/rcds/index.html">Home</a>
        
      
        
      
        
          <a class="sidebar-nav-item" href="/rcds/policies.html">Course Policies</a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a class="sidebar-nav-item" href="/rcds/syllabus.html">Course Syllabus</a>
        
      

    </nav>
    <p>
      <a href="https://github.com/ds421/rcds"><i class="fa fa-github"></i></a>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/licenses/by/4.0/" ><img src="/rcds/public/img/cc-by.svg" alt="cc-by"/></a>
    </p>
  </div>
</div>


    <div class="content container">
      <h1 id="unit-iii-global-fisheries-collapse">Unit III: Global Fisheries Collapse?</h1>

<h2 id="introduction">Introduction</h2>

<ul>
  <li><a href="https://www.youtube.com/watch?v=3fCX6XKzbUY">Atlantic Cod History</a></li>
  <li><a href="https://www.youtube.com/watch?v=H6WOvY_C-_I">“End of the Line” Trailer</a></li>
</ul>

<h2 id="atlantic-cod-history">Atlantic Cod History</h2>

<iframe width="560" height="315" src="https://www.youtube.com/embed/3fCX6XKzbUY" frameborder="0" allowfullscreen=""></iframe>

<h2 id="end-of-the-line">End of the Line</h2>

<iframe width="560" height="315" src="https://www.youtube.com/embed/H6WOvY_C-_I" frameborder="0" allowfullscreen=""></iframe>

<h2 id="cod-collapse">Cod Collapse</h2>

<p>&lt;img src=”http://berkeley.carlboettiger.info/espm-88b/fish/img/codcollapse.jpg” width=600&gt;</p>

<p>Source: http://www.millenniumassessment.org/documents/document.356.aspx.pdf</p>

<h2 id="global-fisheries-trends">Global fisheries trends</h2>

<p>&lt;img src=”http://berkeley.carlboettiger.info/espm-88b/img/worm2006.png” width=700 height = 500&gt;</p>

<h3 id="source-worm-et-al-2006-sciencehttpdoiorg101126science1132294">Source: <a href="http://doi.org/10.1126/science.1132294">Worm et al. 2006 <em>Science</em></a></h3>

<h2 id="media-version">Media version</h2>

<ul>
  <li><a href="http://www.nytimes.com/2006/11/03/science/03fish.html?_r=0">New York Times: “Study Sees ‘Global Collapse’ of Fish Species”</a></li>
  <li><a href="http://news.bbc.co.uk/2/hi/science/nature/6108414.stm">BBC declares: ‘Only 50 years left’ for sea fish</a> </li>
</ul>

<p><img src="http://graphics8.nytimes.com/images/2006/11/02/us/1103-nat-webFISH.gif" alt="" /></p>

<h2 id="the-database">The Database</h2>

<p><a href="http://ramlegacy.marinebiodiversity.ca/ram-legacy-stock-assessment-database">RAM Legacy Stock Assessment Database</a></p>

<p>&lt;img src=”http://ramlegacy.marinebiodiversity.ca/ram-legacy-stock-assessment-database/ram-legacy-entity-relationship-diagram” width=700&gt;</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="s2">"tidyverse"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="s2">"readxl"</span><span class="p">)</span></code></pre></div>

<h2 id="reading-in-the-tables">Reading in the tables</h2>

<!-- 



<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">values</span> <span class="o">&lt;-</span> <span class="n">read_csv</span><span class="p">(</span><span class="s2">"http://berkeley.carlboettiger.info/espm-88b/fish/data/values.csv"</span><span class="p">)</span>
<span class="n">assessment</span> <span class="o">&lt;-</span> <span class="n">read_csv</span><span class="p">(</span><span class="s2">"http://berkeley.carlboettiger.info/espm-88b/fish/data/assessment.csv"</span><span class="p">)</span>
<span class="n">stock</span> <span class="o">&lt;-</span> <span class="n">read_csv</span><span class="p">(</span><span class="s2">"http://berkeley.carlboettiger.info/espm-88b/fish/data/stock.csv"</span><span class="p">)</span>
<span class="n">units</span> <span class="o">&lt;-</span> <span class="n">read_csv</span><span class="p">(</span><span class="s2">"http://berkeley.carlboettiger.info/espm-88b/fish/data/units.csv"</span><span class="p">)</span>
<span class="n">area</span>  <span class="o">&lt;-</span> <span class="n">read_csv</span><span class="p">(</span><span class="s2">"http://berkeley.carlboettiger.info/espm-88b/fish/data/area.csv"</span><span class="p">)</span></code></pre></div>



-->

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">download.file</span><span class="p">(</span><span class="s2">"https://depts.washington.edu/ramlegac/wordpress/databaseVersions/RLSADB_v3.0_(assessment_data_only)_excel.zip"</span><span class="p">,</span> 
              <span class="s2">"ramlegacy.zip"</span><span class="p">)</span>
<span class="n">path</span> <span class="o">&lt;-</span> <span class="n">unzip</span><span class="p">(</span><span class="s2">"ramlegacy.zip"</span><span class="p">)</span>
<span class="n">sheets</span> <span class="o">&lt;-</span> <span class="n">readxl</span><span class="o">::</span><span class="n">excel_sheets</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">ram</span> <span class="o">&lt;-</span> <span class="n">lapply</span><span class="p">(</span><span class="n">sheets</span><span class="p">,</span> <span class="n">readxl</span><span class="o">::</span><span class="n">read_excel</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">)</span>
<span class="n">names</span><span class="p">(</span><span class="n">ram</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">sheets</span>

<span class="c1">## Name the available tables:
</span><span class="n">names</span><span class="p">(</span><span class="n">ram</span><span class="p">)</span></code></pre></div>

<h2 id="exploring-the-database-a-birds-eye-view">Exploring the Database: a bird’s eye view</h2>

<ul>
  <li>“Tidy Data”: Codd’s Third Normal form:</li>
</ul>

<blockquote>
  <p>Each row must describe the Key, the Whole Key, and Nothing But the Key (so help me Cobb)</p>
</blockquote>

<h2 id="what-is-a-stock-assessment">What is a Stock Assessment?</h2>

<ul>
  <li>From the Assessment Table, id: http://www.afsc.noaa.gov/REFM/docs/2010/GOApop.pdf</li>
  <li>From said pdf, methods (in 2009 assessment): http://www.afsc.noaa.gov/refm/docs/2009/GOApop.pdf</li>
</ul>

<blockquote>
  <p>When treated this way, our stock assessment is a large Bayesian model, which includes
informative (e.g., lognormal natural mortality with a small CV) and noninformative (or nearly so, such as
a parameter bounded between 0 and 10) prior distributions. In the model presented in this SAFE report,
the number of parameters estimated is 134.</p>
</blockquote>

<p>– http://www.afsc.noaa.gov/refm/docs/2009/GOApop.pdf pg 757</p>

<h2 id="task-1-investigating-cod-collapse">Task 1: Investigating Cod Collapse</h2>

<p>&lt;img src=”http://berkeley.carlboettiger.info/espm-88b/fish/img/codcollapse.jpg” width=600&gt;</p>

<h2 id="step-1-joining-up-the-data">Step 1: Joining up the data</h2>

<p>We want a table with the following additional columns: <code>"country"</code>, <code>"ssb_unit"</code>, <code>"catch_landings_unit"</code>, <code>"scientificname"</code>, <code>"commonname"</code>, <code>"year"</code>, <code>"ssb"</code>, and <code>"TC"</code> columns.  </p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ram</span><span class="o">$</span><span class="n">timeseries_values_views</span> <span class="o">%&gt;%</span>
  <span class="n">select</span><span class="p">(</span><span class="n">assessid</span><span class="p">,</span> <span class="n">stockid</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">SSB</span><span class="p">,</span> <span class="n">TC</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">left_join</span><span class="p">(</span><span class="n">ram</span><span class="o">$</span><span class="n">stock</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">left_join</span><span class="p">(</span><span class="n">ram</span><span class="o">$</span><span class="n">area</span><span class="p">)</span> <span class="o">%&gt;%</span> 
   <span class="n">select</span><span class="p">(</span><span class="n">assessid</span><span class="p">,</span> <span class="n">stockid</span><span class="p">,</span> <span class="n">scientificname</span><span class="p">,</span> <span class="n">commonname</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">SSB</span><span class="p">,</span> <span class="n">TC</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">left_join</span><span class="p">(</span><span class="n">ram</span><span class="o">$</span><span class="n">timeseries_units_views</span> <span class="o">%&gt;%</span> 
      <span class="n">rename</span><span class="p">(</span><span class="n">TC_units</span> <span class="o">=</span> <span class="n">TC</span><span class="p">,</span> <span class="n">SSB_units</span> <span class="o">=</span> <span class="n">SSB</span><span class="p">))</span> <span class="o">%&gt;%</span> 
   <span class="n">select</span><span class="p">(</span><span class="n">scientificname</span><span class="p">,</span> <span class="n">commonname</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">SSB</span><span class="p">,</span> <span class="n">TC</span><span class="p">,</span> <span class="n">SSB_units</span><span class="p">,</span> <span class="n">TC_units</span><span class="p">)</span> <span class="o">-&gt;</span> 
<span class="n">df</span></code></pre></div>

<p>Join the <code>values</code>, <code>assessment</code>, <code>stock</code>, <code>units</code>, and <code>area</code> tables together.  For each join, it is necessary to identify the <code>key</code> shared by both tables on which the join will take place.  Also be careful to join tables in the correct order such that no data from the desired columns is lost.  (You should have 16,308 rows at the end, the same number that <code>values</code> table started with).</p>

<h2 id="step-2-dealing-with-missing-values">Step 2: Dealing with missing values</h2>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df</span> <span class="o">%&gt;%</span> 
  <span class="n">group_by</span><span class="p">(</span><span class="n">commonname</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">summarise</span><span class="p">(</span><span class="n">catch</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">TC</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="n">filter</span><span class="p">(</span><span class="n">commonname</span> <span class="o">==</span> <span class="s2">"Atlantic cod"</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">catch</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">geom_line</span><span class="p">()</span></code></pre></div>

<h2 id="step-3-aggregating-over-assessments">Step 3: Aggregating over assessments</h2>

<p>Different stock assessments will cover different regions and times for the same species.  To get the full picture of what is happening to any given species, we must sum up the stocks over all of these assessments in a given year.  </p>

<p>Use <code>groups</code> to sum over the <code>TC</code> and <code>ssb</code> data for each year for each species, then select the “Atlantic cod” and plot their <code>TC</code> over time.  </p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df</span> <span class="o">%&gt;%</span> 
  <span class="n">group_by</span><span class="p">(</span><span class="n">commonname</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">summarise</span><span class="p">(</span><span class="n">catch</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">TC</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="n">filter</span><span class="p">(</span><span class="n">commonname</span> <span class="o">==</span> <span class="s2">"Atlantic cod"</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">catch</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">geom_line</span><span class="p">()</span></code></pre></div>

<h2 id="matching-the-mea-plot">Matching the MEA plot</h2>

<p>Not quite right!  This doesn’t seem to quite match the pattern shown by Millennium Ecosystem Assessment plot.  The early years look good, but the total landings here are much larger.  Is this a real discrepancy in the data or have we forgotten something?</p>

<p>The Millenium Ecosystem Assessment does not spell out their data sources, but it does have one hint: their figure just shows fishing off the banks of Newfoundland.  We can see where else Atlantic cod can be found by joining the <code>areas</code> table and <code>stockid</code> table:   </p>

<p>Let’s try just looking at all stock assessessments from Canadian waters instead.  Modify the plot to show just those cod caught by Canada. We’ll need to group by an extra variable now as well.  </p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df</span> <span class="o">%&gt;%</span> 
  <span class="n">group_by</span><span class="p">(</span><span class="n">commonname</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">summarise</span><span class="p">(</span><span class="n">catch</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">TC</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="n">filter</span><span class="p">(</span><span class="n">commonname</span> <span class="o">==</span> <span class="s2">"Atlantic cod"</span><span class="p">,</span> <span class="n">country</span> <span class="o">==</span> <span class="s2">"Canada"</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">catch</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">geom_line</span><span class="p">()</span></code></pre></div>

<h2 id="accounting-for-units">Accounting for units</h2>

<p>Not perfect, but much better.  What about those pesky units?  Determine whether all <code>catch_landings</code> in your plot are using the same units: e.g. MT or (Metric Tonnes), vs E03 (thousands of fish).</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df</span> <span class="o">%&gt;%</span> <span class="n">filter</span><span class="p">(</span><span class="n">TC_units</span> <span class="o">==</span> <span class="s2">"MT"</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">group_by</span><span class="p">(</span><span class="n">commonname</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">summarise</span><span class="p">(</span><span class="n">catch</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">TC</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="n">filter</span><span class="p">(</span><span class="n">commonname</span> <span class="o">==</span> <span class="s2">"Atlantic cod"</span><span class="p">,</span> <span class="n">country</span> <span class="o">==</span> <span class="s2">"Canada"</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">catch</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">geom_line</span><span class="p">()</span></code></pre></div>

<p>Excellent! All the same units so no need to start worrying about the average weight of a cod fish.  Our result is not a perfect match to the MEA, but pretty close.  On to part II to evaluate global collapse trends.</p>

<h2 id="stock-collapses">Stock Collapses</h2>

<p>Following Worm et al (2006), write a function of <code>current_stock</code> and <code>max_stock</code> that will deterime if the current stock is less than 10% of the max stock observed.</p>

<p>Define a new table that computes the total <code>ssb</code> and <code>catch_landings</code> for each year for each species. Select only the columns we need: <code>"scientificname", "tsyear", "ssb_sum", "catch_landings_sum"</code>.  </p>

<ul>
  <li>
    <p>Add a new column to the table that contains for each species the maximum value of <code>catch_landings</code> over all years.</p>
  </li>
  <li>
    <p>Now use  <code>mutate</code> and this new column to compute whether or not each year should be marked as “collapsed” or not.  Add this information as another column in your table.  </p>
  </li>
  <li>Now compute a new table representing the fraction of taxa that are in the ‘collapsed’ state for each year in the data set.  </li>
  <li>Weight your results by the total number of taxa in the data, </li>
  <li>and plot this fraction over time</li>
</ul>

<h2 id="part-iii-aggregate-trends-in-biomass-vs-catch">Part III: Aggregate trends in Biomass vs catch</h2>

<p>Plot the data that aggregates the total spawning stock biomass (ssb) across all species over time between 1950 and 2006.  </p>

<p>To avoid incomparable units, select only data from whichever unit (<code>MT</code> or <code>E03</code>) represents the larger fraction, or create separate plots for the two different measurement units.</p>

<p>Does this mean stocks are increasing, or that we are just assessing and exploiting more new stocks, even as old stocks decline?  Plot the total number of taxa assessed in each year of the data to compare.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="err">##</span> <span class="n">Look</span><span class="p">,</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">taxa</span> <span class="n">covered</span> <span class="n">is</span> <span class="n">increasing</span><span class="p">,</span> <span class="n">adding</span> <span class="n">new</span> <span class="n">fish</span> <span class="n">populations</span> <span class="n">to</span> <span class="n">the</span> <span class="n">mix</span> <span class="n">even</span> <span class="n">as</span> <span class="n">others</span> <span class="n">decline</span></code></pre></div>

<p>To avoid this confounding variable, identify a core group of species that all have data for every year between 1950 and 2006.  </p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Identify a core group of taxa assessed every year from 1950 to 2006.  May be tricky!
</span><span class="err">##</span> <span class="n">Plot</span> <span class="n">ssb</span> <span class="n">and</span> <span class="n">catch_landings</span> <span class="n">between</span> <span class="m">1950</span> <span class="n">and</span> <span class="m">2006</span></code></pre></div>


    </div>

  </body>
</html>
